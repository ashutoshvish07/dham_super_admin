import{r,u as b,a as v,l as M,p as N,q as u,s as Y,j as t,L as G,G as S,B as A,S as L,F as P,P as R,t as U}from"./index-nP3sWgOM.js";import{u as q}from"./formik.esm-Dyqt8FN9.js";import{I as O}from"./ImageUpload-B33Abahr.js";import{A as V}from"./AutoComplete-OgZ3j4BA.js";import{T as K}from"./TextField-Btu36Zmo.js";import{B as T}from"./Button-DYMAArme.js";import{G as W}from"./GetToAction-p5I7uB52.js";import{A as H}from"./Dialog-D7RuuEns.js";import{l as J}from"./lodash-CeyOGm4C.js";import{h as Q}from"./moment-G82_0lEo.js";import{D as X}from"./DataTable-BAyMAVN6.js";import"./index-CcBqUUtn.js";import"./InputLabel-DaDe49tm.js";import"./Autocomplete-Cb93hnIo.js";import"./Close-CYbAYMXT.js";import"./MenuItem-vSBr2iRT.js";import"./DialogContent-CAWl_w7U.js";import"./Checkbox-CVXqhyuK.js";import"./Skeleton-DY2pMhD5.js";import"./colorManipulator-BTVsESXO.js";import"./useThemeProps-Cp5GSgP0.js";const F=j=>{const{cities_data:o,dialogProps:d,type:f}=j,[g,x]=r.useState([o==null?void 0:o.file]),{states:{states:c}}=b(s=>s.location),l=v(),[p,h]=r.useState(!1);r.useEffect(()=>{l(M())},[]);const a=q({initialValues:{stateId:(o==null?void 0:o.stateId)||"",name:(o==null?void 0:o.name)||""},onSubmit:s=>{var C;h(!0);const n=new FormData;n.append("name",s.name),n.append("stateId",(C=s==null?void 0:s.stateId)==null?void 0:C._id),g&&g.map(I=>{n.append("file",I)}),f==="edit"?l(N({city_id:o==null?void 0:o.id,formData:n})).then(()=>{l(u({page:1,page_size:10})),d==null||d.onClose(),h(!1)}):l(Y(n)).then(()=>{l(u({page:1,page_size:10})),d==null||d.onClose(),h(!1)})}}),i=s=>{x(s)},z=s=>{x(g.filter(n=>n!==s))};return t.jsxs("div",{children:[p&&t.jsx(G,{}),t.jsxs("form",{onSubmit:a.handleSubmit,children:[t.jsxs(S,{container:!0,spacing:2,children:[t.jsx(S,{item:!0,xs:12,children:t.jsx(V,{options:c||[],label:"Select State",id:"state-select",name:"stateId",value:a.values.stateId,onChange:s=>{a.setFieldValue("stateId",s||"")},error:a.touched.stateId&&!!a.errors.stateId,helperText:a.touched.stateId&&a.errors.stateId,required:!0,optionKey:"_id",optionLabel:"name",color:"secondary"})}),t.jsx(S,{item:!0,xs:12,children:t.jsx(K,{fullWidth:!0,id:"name",name:"name",label:"City Name",value:a.values.name,onChange:a.handleChange,error:a.touched.name&&!!a.errors.name,helperText:a.touched.name&&a.errors.name})}),t.jsx(S,{item:!0,xs:12,children:t.jsx(O,{label:"Upload Your Images",files:g,setFiles:i,deleteFile:z})})]}),t.jsx(A,{sx:{display:"flex",justifyContent:"flex-end",marginTop:2},children:t.jsx(T,{type:"submit",variant:"outlined",color:"secondary",size:"medium",children:"Submit"})})]})]})},ye=()=>{var D;const[j,o]=r.useState(""),[d,f]=r.useState(null),[g,x]=r.useState(""),[c,l]=r.useState({open:!1,onClose:()=>l({...c,open:!1})}),[p,h]=r.useState({page:0,pageSize:10}),a=v(),{cities:i,loading:z,error:s}=b(e=>e.location),{states:n}=b(e=>e.location);r.useEffect(()=>{a(u({page:1,page_size:10}))},[a]);const C=()=>{o("Add City"),f(t.jsx(F,{dialogProps:c,state:n==null?void 0:n.states})),l({...c,open:!0})},I=e=>{const m=i==null?void 0:i.cities.find(y=>y.id===e);o("Edit City"),f(t.jsx(F,{dialogProps:c,cities_data:m,type:"edit"})),l({...c,open:!0})},B=e=>{a(U({city_id:e})),a(u({page:1,page_size:10}))},k=[{field:"file",headerName:"Media",width:200,renderCell:e=>{var m,y;return t.jsx("img",{alt:(m=e==null?void 0:e.value)==null?void 0:m.Bucket,src:(y=e==null?void 0:e.value)==null?void 0:y.Url,height:140,width:80})}},{field:"name",headerName:"City name",flex:2},{field:"createdAt",headerName:"Added Date",flex:2,renderCell:e=>Q(e.value).format("DD/MM/YYYY")},{field:"id",headerName:"Action",flex:1,renderCell:e=>W(e.value,I,B)}],_=e=>{e.pageSize==p.pageSize?(a(u({page:e.page+1,page_size:e.pageSize})),h(e)):(a(u({page:e.page,page_size:e.pageSize})),h({page:1,pageSize:e.pageSize}))},w=r.useCallback(J.debounce(e=>{a(u({page:p.page+1,page_size:p==null?void 0:p.pageSize,search:e}))},1e3),[]),E=e=>{const m=e.target.value;x(m),w(m)};return t.jsxs("div",{children:[t.jsx(H,{title:j,content:d,dialogProps:c}),t.jsxs(A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:2},children:[t.jsx(A,{children:t.jsx(L,{value:g,handleSearchChange:E})}),t.jsx(T,{sx:{borderRadius:2},variant:"outlined",color:"secondary",size:"large",onClick:C,startIcon:t.jsx(P,{size:14}),children:"City"})]}),t.jsx(R,{children:t.jsx(X,{data:i==null?void 0:i.cities,columns:k,loading:z,initialState:{pagination:{paginationModel:{pageSize:10}}},rowCount:(D=i==null?void 0:i.cities)==null?void 0:D.length,paginationMode:"server",onPaginationModelChange:_,pageSizeOptions:[10],disableRowSelectionOnClick:!0,getRowId:e=>e._id?e._id:e.id})})]})};export{ye as default};
