import{a8 as he,at as je,au as _e,av as pe,aw as ce,j as t,v as ge,a0 as Ie,a as be,r as z,u as Ce,L as ke,G as i,a3 as V,ax as qe,ay as De,q as Be,l as Te,az as Me}from"./index-nP3sWgOM.js";import{F as Ye,a as Re,b as o,c as ne}from"./formik.esm-Dyqt8FN9.js";import{c as G,a as p,f as H,e as Se,d as J,b as oe}from"./index.esm-B2q6Cw9c.js";import{I as Pe}from"./index-BYu15YCe.js";import{I as $e}from"./ImageUpload-B33Abahr.js";import{A as le}from"./AutoComplete-OgZ3j4BA.js";import{h}from"./moment-G82_0lEo.js";import{a as K}from"./InputLabel-DaDe49tm.js";import{T as l}from"./TextField-Btu36Zmo.js";import{M as $}from"./MenuItem-vSBr2iRT.js";import{B as U}from"./Button-DYMAArme.js";import"./index-CcBqUUtn.js";import"./Autocomplete-Cb93hnIo.js";import"./Close-CYbAYMXT.js";const Fe=he("MuiBox",["root"]),de=je({defaultClassName:Fe.root,generateClassName:_e.generate});var Z={},We=ce;Object.defineProperty(Z,"__esModule",{value:!0});var Q=Z.default=void 0,ze=We(pe()),Le=t;Q=Z.default=(0,ze.default)((0,Le.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete");var v={},we=ce;Object.defineProperty(v,"__esModule",{value:!0});var X=v.default=void 0,Ne=we(pe()),Oe=t;X=v.default=(0,Ne.default)((0,Oe.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add");const at=()=>{const L=ge(),{id:m}=Ie(),u=be(),[F,W]=z.useState([]),{cities:w,states:N}=Ce(r=>r.location),[me,c]=z.useState(!1),[ue,A]=z.useState({title:"",description:"",start_from:"",end_at:"",departure_date:"",departure_time:"",duration:"",plans:[{day:"",destination:"",description:""}],packageCost:[{package:"Basic",cost:""}],type:"event",departure_from:"",cityId:"",stateId:""});z.useEffect(()=>{(async()=>{try{c(!0),await Promise.all([u(Be({page:1,page_size:10})),u(Te({page:1,page_size:10}))]),m?u(Me({id:m})).then(a=>{const{tourAndEvent:e}=a==null?void 0:a.payload;A({title:(e==null?void 0:e.title)||"",description:(e==null?void 0:e.description)||"",start_from:h(e==null?void 0:e.start_from).format("YYYY-MM-DD")||"",end_at:h(e==null?void 0:e.end_at).format("YYYY-MM-DD")||"",departure_date:h(e==null?void 0:e.departure_date).format("YYYY-MM-DD")||"",departure_time:(e==null?void 0:e.departure_time)||"",stateId:(e==null?void 0:e.stateId)||"",duration:(e==null?void 0:e.duration)||"",plans:(e==null?void 0:e.plans)||[{day:"",destination:"",description:""}],type:(e==null?void 0:e.type)||"event",departure_from:(e==null?void 0:e.departure_from)||"",cityId:(e==null?void 0:e.cityId)||"",packageCost:(e==null?void 0:e.packageCost)||[{package:"Basic",cost:""}]}),W(e.files),c(!1)}):(A({title:"",description:"",start_from:"",end_at:"",departure_date:"",departure_time:"",duration:"",stateId:"",plans:[{day:"",destination:"",description:""}],type:"event",departure_from:"",cityId:""}),W([]),c(!1))}catch(a){console.error("Error fetching data:",a),c(!1)}})()},[u,m]);const xe=r=>{W(r)},fe=r=>{W(F.filter(a=>a!==r))},ye=G({title:p().required("Required"),description:p().required("Required"),start_from:H().required("Required"),end_at:H().required("Required").min(Se("start_from"),"End date must be after start date"),departure_date:H().required("Required"),departure_time:p().required("Required"),duration:J().positive("Must be positive").integer("Must be an integer").required("Required"),type:p().required("Required"),departure_from:p().required("Required"),plans:oe().of(G().shape({day:J().positive("Must be positive").integer("Must be an integer").required("Required"),destination:p().required("Required"),description:p().required("Required")})).min(1,"At least one plan is required"),packageCost:oe().of(G().shape({package:p().oneOf(["VIP","Basic"]).required("Required"),cost:J().positive("Must be positive").required("Required")})).min(1,"At least one pricing option is required")});return t.jsxs(t.Fragment,{children:[me&&t.jsx(ke,{}),t.jsxs(i,{container:!0,justifyContent:"space-between",alignItems:"center",sx:{mb:2},children:[t.jsx(K,{color:"secondary",edge:"start",size:"large","aria-label":"back",onClick:()=>L("/event-tours"),children:t.jsx(Pe,{})}),t.jsx(V,{variant:"h2",gutterBottom:!0,children:m?"Edit Event & Tours":"Create Event & Tours"})]}),t.jsx(Ye,{initialValues:ue,validationSchema:ye,enableReinitialize:!0,onSubmit:(r,{setSubmitting:a})=>{var O,j,d,x,f,s;c(!0);const e=new FormData;e.append("title",r.title),e.append("description",r.description),e.append("start_from",h(r.start_from).format("YYYY-MM-DD")),e.append("end_at",h(r.end_at).format("YYYY-MM-DD")),e.append("departure_date",h(r.departure_date).format("YYYY-MM-DD")),e.append("departure_time",r.departure_time),e.append("duration",r.duration),e.append("type",r.type),e.append("departure_from",r.departure_from),e.append("cityId",(O=r.cityId)!=null&&O._id?(j=r.cityId)==null?void 0:j._id:(d=r.cityId)==null?void 0:d.id),e.append("plans",JSON.stringify(r.plans)),e.append("packageCost",JSON.stringify(r.packageCost)),e.append("stateId",(x=r==null?void 0:r.stateId)!=null&&x._id?(f=r==null?void 0:r.stateId)==null?void 0:f._id:(s=r==null?void 0:r.stateId)==null?void 0:s._id),F.length&&F.forEach((n,y)=>{e.append("files[]",n)}),m?u(De({formData:e,id:m})).then(n=>{L("/event-tours"),c(!1)}):u(qe(e)).then(n=>{L("/event-tours"),c(!1)}),a(!1)},children:({values:r,errors:a,touched:e,handleChange:O,setFieldValue:j})=>t.jsx(Re,{children:t.jsxs(i,{container:!0,spacing:2,children:[t.jsx(i,{item:!0,xs:12,children:t.jsx(o,{as:l,fullWidth:!0,label:"Title",color:"secondary",name:"title",error:e.title&&!!a.title,helperText:e.title&&a.title})}),t.jsx(i,{item:!0,xs:12,children:t.jsx(o,{as:l,fullWidth:!0,label:"Description",name:"description",multiline:!0,rows:4,color:"secondary",error:e.description&&!!a.description,helperText:e.description&&a.description})}),t.jsx(i,{item:!0,xs:4,children:t.jsx(o,{as:l,fullWidth:!0,label:"Start Date",name:"start_from",type:"date",color:"secondary",InputLabelProps:{shrink:!0},error:e.start_from&&!!a.start_from,helperText:e.start_from&&a.start_from})}),t.jsx(i,{item:!0,xs:4,children:t.jsx(o,{as:l,fullWidth:!0,label:"End Date",name:"end_at",type:"date",color:"secondary",InputLabelProps:{shrink:!0},error:e.end_at&&!!a.end_at,helperText:e.end_at&&a.end_at})}),t.jsx(i,{item:!0,xs:4,children:t.jsx(o,{as:l,fullWidth:!0,label:"Departure Date",name:"departure_date",type:"date",color:"secondary",InputLabelProps:{shrink:!0},error:e.departure_date&&!!a.departure_date,helperText:e.departure_date&&a.departure_date})}),t.jsx(i,{item:!0,xs:6,children:t.jsx(o,{as:l,fullWidth:!0,label:"Departure Time",name:"departure_time",type:"time",color:"secondary",InputLabelProps:{shrink:!0},error:e.departure_time&&!!a.departure_time,helperText:e.departure_time&&a.departure_time})}),t.jsx(i,{item:!0,xs:6,children:t.jsx(o,{as:l,color:"secondary",fullWidth:!0,label:"Duration (Days)",name:"duration",type:"number",error:e.duration&&!!a.duration,helperText:e.duration&&a.duration})}),t.jsx(i,{item:!0,xs:6,children:t.jsxs(o,{as:l,fullWidth:!0,color:"secondary",select:!0,label:"Type",name:"type",error:e.type&&!!a.type,helperText:e.type&&a.type,children:[t.jsx($,{value:"event",children:"Event"}),t.jsx($,{value:"tour",children:"Tour"})]})}),t.jsx(i,{item:!0,xs:6,children:t.jsx(o,{as:l,fullWidth:!0,color:"secondary",label:"Departure From",name:"departure_from",error:e.departure_from&&!!a.departure_from,helperText:e.departure_from&&a.departure_from})}),t.jsx(i,{item:!0,xs:12,sm:6,children:t.jsx(le,{options:(w==null?void 0:w.cities)||[],label:"Select City",id:"city-select",name:"cityId",value:r.cityId,onChange:d=>{j("cityId",d||"")},error:e.cityId&&!!a.cityId,helperText:e.cityId&&a.cityId,required:!0,optionKey:"_id",optionLabel:"name",color:"secondary"})}),t.jsx(i,{item:!0,xs:12,sm:6,children:t.jsx(le,{options:(N==null?void 0:N.states)||[],label:"Select State",id:"state-select",name:"stateId",value:r.stateId,onChange:d=>{j("stateId",d||"")},error:e.stateId&&!!a.stateId,helperText:e.stateId&&a.stateId,required:!0,optionKey:"_id",optionLabel:"name",color:"secondary"})}),t.jsxs(i,{item:!0,xs:12,children:[t.jsx(V,{variant:"h6",sx:{mb:1},children:"Plans"}),t.jsx(ne,{name:"plans",children:({remove:d,push:x})=>t.jsxs("div",{children:[r.plans.map((f,s)=>{var n,y,_,g,I,b,C,k,q,D,B,T,M,Y,R,S,P,E,ee,te,ae,re,ie,se;return t.jsxs(i,{container:!0,spacing:2,alignItems:"center",justifyContent:"center",children:[t.jsx(i,{item:!0,xs:2,children:t.jsx(o,{as:l,fullWidth:!0,label:"Day",name:`plans.${s}.day`,color:"secondary",type:"number",error:((y=(n=e.plans)==null?void 0:n[s])==null?void 0:y.day)&&!!((g=(_=a.plans)==null?void 0:_[s])!=null&&g.day),helperText:((b=(I=e.plans)==null?void 0:I[s])==null?void 0:b.day)&&((k=(C=a.plans)==null?void 0:C[s])==null?void 0:k.day)})}),t.jsx(i,{item:!0,xs:3,children:t.jsx(o,{as:l,fullWidth:!0,label:"Destination",color:"secondary",name:`plans.${s}.destination`,error:((D=(q=e.plans)==null?void 0:q[s])==null?void 0:D.destination)&&!!((T=(B=a.plans)==null?void 0:B[s])!=null&&T.destination),helperText:((Y=(M=e.plans)==null?void 0:M[s])==null?void 0:Y.destination)&&((S=(R=a.plans)==null?void 0:R[s])==null?void 0:S.destination)})}),t.jsx(i,{item:!0,xs:5,children:t.jsx(o,{as:l,fullWidth:!0,color:"secondary",label:"Description",name:`plans.${s}.description`,error:((E=(P=e.plans)==null?void 0:P[s])==null?void 0:E.description)&&!!((te=(ee=a.plans)==null?void 0:ee[s])!=null&&te.description),helperText:((re=(ae=e.plans)==null?void 0:ae[s])==null?void 0:re.description)&&((se=(ie=a.plans)==null?void 0:ie[s])==null?void 0:se.description)})}),t.jsx(i,{item:!0,xs:2,children:t.jsx(K,{color:"secondary",onClick:()=>d(s),children:t.jsx(Q,{})})}),t.jsx(i,{item:!0,xs:2,style:{marginTop:"4px"},children:" "})]},s)}),t.jsx(U,{startIcon:t.jsx(X,{}),onClick:()=>x({day:"",destination:"",description:""}),children:"Add Plan"})]})})]}),t.jsxs(i,{item:!0,xs:12,children:[t.jsx(V,{variant:"h6",sx:{mb:1},children:"Pricing Options"}),t.jsx(ne,{name:"packageCost",children:({remove:d,push:x})=>{var f;return t.jsxs(de,{display:"flex",flexDirection:"column",rowGap:2,justifyContent:"flex-start",alignItems:"flex-start",children:[(f=r==null?void 0:r.packageCost)==null?void 0:f.map((s,n)=>{var y,_,g,I,b,C,k,q,D,B,T,M,Y,R,S,P;return t.jsxs(i,{container:!0,spacing:2,alignItems:"center",rowGap:2,justifyContent:"center",children:[t.jsx(i,{item:!0,xs:4,children:t.jsxs(o,{as:l,fullWidth:!0,select:!0,label:"Package",name:`packageCost.${n}.package`,color:"secondary",error:((_=(y=e.packageCost)==null?void 0:y[n])==null?void 0:_.package)&&!!((I=(g=a.packageCost)==null?void 0:g[n])!=null&&I.package),helperText:((C=(b=e.packageCost)==null?void 0:b[n])==null?void 0:C.package)&&((q=(k=a.packageCost)==null?void 0:k[n])==null?void 0:q.package),children:[t.jsx($,{value:"none",children:"None"}),t.jsx($,{value:"VIP",children:"VIP"}),t.jsx($,{value:"Basic",children:"Basic"})]})}),t.jsx(i,{item:!0,xs:4,children:t.jsx(o,{as:l,fullWidth:!0,label:"Cost",name:`packageCost.${n}.cost`,type:"number",color:"secondary",error:((B=(D=e.packageCost)==null?void 0:D[n])==null?void 0:B.cost)&&!!((M=(T=a.packageCost)==null?void 0:T[n])!=null&&M.cost),helperText:((R=(Y=e.packageCost)==null?void 0:Y[n])==null?void 0:R.cost)&&((P=(S=a.packageCost)==null?void 0:S[n])==null?void 0:P.cost)})}),t.jsx(i,{item:!0,xs:2,children:t.jsx(K,{color:"secondary",onClick:()=>d(n),children:t.jsx(Q,{})})}),t.jsx(i,{item:!0,xs:2,style:{marginTop:"4px"}})]},n)}),t.jsx(U,{startIcon:t.jsx(X,{}),onClick:()=>x({package:"Basic",cost:""}),children:"Add Pricing Option"})]})}})]}),t.jsx(i,{item:!0,xs:12,children:t.jsx($e,{files:F,setFiles:xe,deleteFile:fe})}),t.jsx(i,{item:!0,xs:12,children:t.jsx(de,{sx:{display:"flex",justifyContent:"flex-end",marginTop:2},children:t.jsx(U,{type:"submit",variant:"contained",color:"secondary",size:"medium",children:"Submit"})})})]})})})]})};export{at as default};
